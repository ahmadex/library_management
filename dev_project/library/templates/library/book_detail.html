{% extends 'base.html' %}

{% block content %}
<h4 style='margin-top:100px;'>Welcom Student</h4>
<div class='row'>
    <div class='col-md-2'>
        <div class="media align-items-center py-3 mb-3">
            <img src="{{book.cover_page.url}}" class="" style='width:200px;'>
            <div class="media-body ml-4">
            <div class="text-muted mb-2">ID: {{book.id}}</div>
            {% if user.is_staff %}
                <a href="{% url 'library:book_update' book.id %}" class="btn btn-primary btn-sm">Edit</a>&nbsp;
                <a href="javascript:void(0)" class="btn btn-default btn-sm icon-btn"><i class="fa fa-mail"></i></a>

                <a id='delete' href="{% url 'library:book_delete' book.id %}" class="btn btn-danger btn-sm">Delete</a>&nbsp;
                <a href="javascript:void(0)" class="btn btn-default btn-sm icon-btn"><i class="fa fa-mail"></i></a>
            {% endif %}
            </div>
        </div>
    </div>
    <div class='col' style='margin-left:10%; margin-top:20px;'>
        <div class="card mb-4">
            <div class="card-body">
            <table class="table user-view-table m-0">
                <tbody>
                <tr>
                    <td>Author:</td>
                    <td>{{book.author}}</td>
                </tr>
                <tr>
                    <td>Title</td>
                    <td>{{book.title}}</td>
                </tr>
                <tr>
                    <td>Genre</td>
                    <td><span class="badge badge-outline-success"></span>{{book.category}}</td>
                </tr>
                <tr>
                    <td>Available Copies:</td>
                    <td><span id='available'>{{book.available_copy}}</span></td>
                </tr>
                <tr>
                    <td>No of Copies</td>
                    <td> 
                    {% if user.is_staff %}
                    <a href="#" id='plus' class="btn btn-primary btn-sm">+</a>&nbsp;
                    {% endif %}
                    <span id='copy'>{{book.no_of_copy}}</span>&nbsp;
                    {% if user.is_staff %}
                    <a href="#" id='minus' class="btn btn-primary btn-sm">-</a>
                    {% endif %}
                    </td>
                </tr>
                </tbody>
            </table>
            </div>
            <hr class="border-light m-0">
            <div class="table-responsive">
            <table class="table card-table m-0">
                <tbody>
                <tr>
                    <th>Desription</th>
                </tr>
                <tr>
                    <td>{{book.description|slice:150}}</td>
                </tr>
                
                </tbody>
            </table>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block javascript %}
    <script type='text/javascript'>
    $(function(){
        
        //No of copies increament
        
        $('#plus').on('click',function(){
            let bookId = $('.text-muted').text()
            $.ajax({
                url:`{% url 'library:copy_incrmt'%}`,
                method:'POST',
                data: {
                    id:{{book.id}},
                    csrfmiddlewaretoken: '{{csrf_token}}',
                    sign: 'plus'
                },
                success: function(data){
                    console.log(data.status)
                    if(data.status == "1"){
                        $('#copy').text(data.book_copy) 
                        $('#available').text(data.avail)

                    }
                }
            })
        });


        // no of copies decreamnet

        $('#minus').on('click',function(){

            if(Number($('#copy').text()) < 1){
                alert('NO of Copies Can not be Negative')  
                throw error('Minus Copy not valid')
            }

            let bookId = $('.text-muted').text()
            
            $.ajax({
                url:`{% url 'library:copy_incrmt'%}`,
                method:'POST',
                data: {
                    id:{{book.id}},
                    csrfmiddlewaretoken: '{{csrf_token}}',
                    sign: 'minus'
                },
                success: function(data){
                    console.log(data.status)
                    if(data.status == "1"){
                        $('#copy').text(data.book_copy)
                        $('#available').text(data.avail)
                    }
                }
            })
        });


    });
    

    </script>

{% endblock %}